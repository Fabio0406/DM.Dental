<% 
const body = `
<div class="container-fluid mt-4">
    <div class="row">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h3><i class="bi bi-journal-text"></i> Formularios SALMI</h3>
                <a href="/ocr/upload" class="btn btn-primary">
                    <i class="bi bi-camera"></i> Escanear nuevo formulario
                </a>
            </div>
        </div>
    </div>

    ${locals.error ? `
        <div class="alert alert-danger">${error}</div>
    ` : ''}

    ${formularios.length === 0 ? `
        <div class="row">
            <div class="col-12">
                <div class="text-center py-5">
                    <h4 class="text-muted"><i class="bi bi-file-earmark-text"></i> No hay formularios procesados</h4>
                    <p class="text-muted">Sube tu primer formulario SALMI para empezar</p>
                    <a href="/ocr/upload" class="btn btn-primary btn-lg">
                        <i class="bi bi-camera"></i> Escanear formulario
                    </a>
                </div>
            </div>
        </div>
    ` : `
        <div class="row">
            <div class="col-12">
                <div class="card">
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead class="table-light">
                                    <tr>
                                        <th>Fecha</th>
                                        <th>Estado</th>
                                        <th>Items</th>
                                        <th>Vista previa</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${formularios.map(formulario => `
                                        <tr>
                                            <td>
                                                <strong>${new Date(formulario.fecha_procesamiento).toLocaleDateString('es-BO')}</strong>
                                                <br>
                                                <small class="text-muted">
                                                    ${new Date(formulario.fecha_procesamiento).toLocaleTimeString('es-BO')}
                                                </small>
                                            </td>
                                            <td>
                                                <span class="badge ${
                                                    formulario.estado_procesamiento === 'completado' ? 'bg-success' : 
                                                    formulario.estado_procesamiento === 'procesando' ? 'bg-warning' : 
                                                    formulario.estado_procesamiento === 'error' ? 'bg-danger' : 'bg-secondary'
                                                }">
                                                    ${
                                                        formulario.estado_procesamiento === 'completado' ? '<i class="bi bi-check-circle"></i> Completado' : 
                                                        formulario.estado_procesamiento === 'procesando' ? '<i class="bi bi-hourglass-split"></i> Procesando' : 
                                                        formulario.estado_procesamiento === 'error' ? '<i class="bi bi-x-circle"></i> Error' : '<i class="bi bi-pause-circle"></i> Pendiente'
                                                    }
                                                </span>
                                            </td>
                                            <td>
                                                <span class="badge bg-primary">${formulario.total_items || 0}</span>
                                                <small class="text-muted">items detectados</small>
                                            </td>
                                            <td>
                                                <img src="${formulario.imagen_path}" alt="Preview" 
                                                     class="img-thumbnail" style "max-width: 60px; max-height: 60px;">
                                            </td>
                                            <td>
                                                <div class="btn-group btn-group-sm">
                                                    <a href="/ocr/review/${formulario.id_formulario}" 
                                                       class="btn btn-outline-primary">
                                                        <i class="bi bi-eye"></i> Ver
                                                    </a>
                                                    ${formulario.estado_procesamiento === 'completado' ? `
                                                        <button class="btn btn-outline-success" disabled>
                                                            <i class="bi bi-check-circle"></i> Importar
                                                        </button>
                                                    ` : ''}
                                                </div>
                                            </td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    `}
</div>
`;
%>

<%- include('../layouts/main', { title: title, body: body }) %>